> **重要声明**
>
> 本插件基于 [shskjw](https://github.com/shskjw) 大佬的开源项目 [astrbot_plugin_shoubanhua](https://github.com/shskjw/astrbot_plugin_shoubanhua) 进行了深度的二次开发和功能扩展。
>
> ---

# 通过第三方柏拉图AI调用 Banana API
注册地址 [柏拉图AI](https://api.bltcy.ai/register?aff=63Ig)

## 功能特性

- **多风格转换**：内置十几种指令，如 `/手办化`、`/Q版化`、`/痛车化`、`/鬼图` 等，满足不同场景需求。
- **多图输入**：支持同时发送或引用多张图片，模型将融合所有图片信息进行创作。
- **自定义生成**：
  - 使用 `/自定义图生图 <提示词> [图片]` 指令，可以附带图片进行创作。
  - 使用 `/自定义文生图 <提示词>` 指令，可以完全基于文本进行创作。
- **智能自然对话生图**：在设置中开启并配置意图判断大模型后，可通过日常对话（如“画一个男孩”或发送图片并说“把它变赛博朋克”）智能触发AI绘画。
- **灵活的输入方式**：支持直接发送图片、回复图片、或`@用户`来使用其头像进行制作。
- **强大的管理功能 (管理员限定)**：
  - **Key 管理**：通过指令动态添加、查看、删除 API Key，支持配置多个 Key 并自动轮换使用。
  - **用户/群组次数管理**：可为用户和群组设置使用次数，并通过指令进行增加和查询，实现轻量级付费或激励机制。
- **高度可定制**：所有指令的默认提示词（Prompt）以及意图判断逻辑均可在后台配置文件中调整。
- **代理支持**：内置网络代理支持，方便在特殊网络环境下部署。

## 安装与配置

### 安装

1.  下载本插件，解压后得到 `astrbot_plugin_nano_banana` 文件夹。
2.  将该文件夹放入 `astrbot/plugins` 目录下。
3.  重启 AstrBot。

### 配置

在 AstrBot 管理面板的 `插件管理` -> `Nano Banana 生图` 中进行配置。

#### 主要配置

| 配置项             | 类型   | 描述                                                                                                                              |
| ------------------ | ------ | --------------------------------------------------------------------------------------------------------------------------------- |
| `api_url`          | 字符串 | **(必需)** 生图 API 的请求地址。                                                                                                       |
| `api_keys`         | 列表   | **(必需)** 生图 API 的密钥。可以通过 `/生图添加key` 指令管理。                                                             |
| `use_proxy`        | 开关   | 是否为插件启用网络代理。                                                                                                          |
| `proxy_url`        | 字符串 | 代理服务器地址，例如 `http://127.0.0.1:7890`。                                                                                    |
| `enable_natural_conversation_drawing` | 开关 | **(核心功能)** 是否开启自然对话生图功能。开启后，需正确配置下方的“智能意图判断”部分。 |

#### 智能意图判断 (可选)

如果你开启了 `enable_natural_conversation_drawing`，则需要配置以下项，让大模型能够智能理解用户的绘画意图。

| 配置项 | 类型 | 描述 |
| :--- | :--- | :--- |
| `intent_api_base_url` | 字符串 | **(必需)** 用于意图判断的大模型 API 地址，需兼容 OpenAI 格式。 |
| `intent_api_keys` | 列表 | **(必需)** 意图判断大模型的 API 密钥。 |
| `intent_model_name` | 字符串 | **(必需)** 意图判断大模型的具体名称，例如 `gpt-4o`。 |
| `intent_prompt` | 文本 | 指导大模型如何分析并以固定JSON格式返回结果的系统提示词，通常无需修改。 |

---

## 📖 命令列表

### 基础命令 (图生图)

| 命令 | 功能说明 |
| :--- | :--- |
| `/手办化` | 生成标准手办化图片 |
| `/Q版化` | 生成Q版手办化图片 |
| `/痛屋化` | 生成痛屋场景图片 |
| `/痛车化` | 生成痛车场景图片 |
| `/cos化` | 生成cosplay照片 |
| `/cos自拍` | 生成cosplay自拍 |
| `/孤独的我` | 生成孤独场景图片 |
| `/第三视角` | 生成第三人称视角场景 |
| `/痛屋化2` | 生成改良版痛屋场景 |
| `/鬼图` | 生成灵异鬼图风格照片 |
| `/第一视角` | 生成第一人称视角场景 |
| `/手办化2` - `/手办化6` | 不同版本的手办化 |
| `/玉足` | 生成玉足图片 |
| `/fumo化` | 生成fumo化图片 |
| `/贴纸化` | 生成剪贴纸化图片 |

### 自定义与查询

| 命令 | 功能说明 |
| :--- | :--- |
| `/自定义图生图 <提示词>` | 使用自定义提示词和图片生成 |
| `/自定义文生图 <提示词>` | 仅使用自定义提示词生成 |
| `/生图查询次数` | 查询自己的剩余次数 |

### 👑 管理命令 (仅主人)

| 命令 | 功能说明 |
| :--- | :--- |
| `/生图添加key <key1>...` | 添加一个或多个API密钥 |
| `/生图key列表` | 查看API密钥列表 |
| `/生图删除key <序号\|all>` | 删除API密钥 |
| `/生图增加用户次数 <QQ号> <次数>` | 为用户增加使用次数 |
| `/生图增加群组次数 <群号> <次数>` | 为群组增加使用次数 |
| `/生图查询次数 <QQ号/群q>` | 查询指定用户剩余次数 |

---

## 注
本插件是基于维拉大佬写的js改的。 感谢维拉大佬的支持```
> **重要声明**
>
> 本插件基于 [shskjw](https://github.com/shskjw) 大佬的开源项目 [astrbot_plugin_shoubanhua](https://github.com/shskjw/astrbot_plugin_shoubanhua) 进行了深度的二次开发和功能扩展。
>
> ---
# Nano Banana 生图插件 (astrbot_plugin_nano_banana)

**作者:** 沐沐沐倾
**版本:** 1.0.1
**仓库:** [Github](https://github.com/mangen-wx/astrbot_plugin_nano_banana)

一款功能强大的AI生图插件，基于柏拉图API，集成了多种预设风格、自定义图/文生图、智能对话绘画及后台管理功能。

## ✨ 核心功能

- **智能对话绘画 (LLM工具调用)**: 依赖AstrBot核心LLM的工具调用能力，可以直接通过自然语言与机器人对话来生成或修改图片。此功能可在后台配置中开启或关闭。
- **丰富的预设指令**: 内置十几种图生图指令，如 `/手办化`, `/Q版化`, `/cos化` 等，一键生成特定风格。
- **自定义生图**: 支持通过 `/自定义文生图` 和 `/自定义图生图` 指令，使用自己的Prompt进行创作。
- **灵活的输入方式**: 指令模式下支持直接发送图片、回复图片、或`@用户`来使用其头像进行制作。
- **强大的管理功能**: 管理员可以通过指令轻松管理API Key、增减用户和群组的使用次数。
- **灵活的次数控制**: 支持分别或同时开启个人和群组的使用次数限制。
- **多API Key轮换与重试**: 可配置多个API Key，插件会在请求失败时自动切换，提高可用性。
- **自动清理**: 卸载插件时，会自动删除所有相关的缓存和数据文件，保持系统清洁。

## ⚙️ 安装与配置

### 安装

1.  下载本插件，将 `astrbot_plugin_nano_banana` 整个文件夹放入您的AstrBot插件目录 (`/plugins`) 中。
2.  重启 AstrBot。

### 配置

在 AstrBot 管理面板的 `插件管理` -> `Nano Banana 生图` 中进行配置。

| 配置项             | 描述                                                                                                                              |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------- |
| `api_url`          | **(必需)** 生图 API 的请求地址。                                                                                                       |
| `api_keys`         | **(必需)** 生图 API 的密钥。可以通过 `/生图添加key` 指令管理。                                                             |
| `enable_llm_tools` | **(核心功能开关)** 是否开启自然对话生图功能。开启后，插件将注册为核心LLM的工具。 |
| `use_proxy`        | 是否为插件启用网络代理。                                                                                                          |
| `proxy_url`        | 代理服务器地址，例如 `http://127.0.0.1:7890`。                                                                                    |
| `enable_user_limit`| 是否开启个人使用次数限制。|
| `enable_group_limit`| 是否开启群组共享使用次数限制。|
| ... | 其他权限和自定义设置请在后台查看。 |

**重要提示**: `enable_llm_tools` 功能**强依赖**于您在AstrBot核心中配置的主LLM。请确保您的主LLM支持并开启了**工具调用 (Function Calling)** 功能。

---

## 📖 命令列表

### 1. 自然语言绘画 (需开启LLM工具)

- **文生图**:
  > 画一只可爱的猫
  > 生成一张赛博朋克风格的城市夜景

- **图生图**:
  > (发送一张照片后) 把它变成梵高风格
  > (回复一张人物图) 给图里的人加一副眼镜

### 2. 预设指令 (部分)

| 命令 | 功能说明 |
| :--- | :--- |
| `/手办化` | 生成标准手办化图片 |
| `/Q版化` | 生成Q版手办化图片 |
| `/痛屋化`, `/痛屋化2` | 生成痛屋场景图片 |
| `/痛车化` | 生成痛车场景图片 |
| `/cos化`, `/cos自拍` | 生成cosplay照片 |
| ... | 更多指令请使用 `/生图帮助` 查看 |

### 3. 自定义与查询

| 命令 | 功能说明 |
| :--- | :--- |
| `/自定义图生图 <提示词>` | 使用自定义提示词和图片生成 |
| `/自定义文生图 <提示词>` | 仅使用自定义提示词生成 |
| `/生图查询次数` | 查询自己的剩余次数 |
| `/生图帮助` | 显示帮助信息 |

### 4. 👑 管理命令 (仅主人)

| 命令 | 功能说明 |
| :--- | :--- |
| `/生图添加key <key1>...` | 添加一个或多个API密钥 |
| `/生图key列表` | 查看API密钥列表 |
| `/生图删除key <序号\|all>` | 删除API密钥 |
| `/生图增加用户次数 <QQ号> <次数>` | 为用户增加使用次数 |
| `/生图增加群组次数 <群号> <次数>` | 为群组增加使用次数 |
